### 1.索引介绍
索引的出现是为了提高数据的查询效率。对于数据库表而言，索引就是其“目录”。  
索引也会带来一些负面影响：  
* 创建索引和维护索引需要耗费时间，这个时间随着数据量的增加而增加；  
* 索引需要额外的存储空间；  
* 当对表进行数据操作时，相应的索引也要动态维护，这就降低了数据的维护速度；  

#### 建立索引的原则
（1）在最频繁使用的，用来缩小查询范围的字段上建立索引；  
（2）在频繁使用的，需要排序的字段上建立索引；  

#### 不适合建立索引的情况
（1）查询中很少涉及的列或者重复值比较多的列，不适合建立索引；  
（2）对于一些特殊的数据类型，不宜建立索引，比如：文本字段（text）等。  

### 2.索引底层使用的数据结构
索引使用的数据结构和具体存储引擎的实现有关，MySQL中使用较多的索引有hash索引、B+树索引等。  
其中InnoDB存储引擎默认索引实现为B+树索引。  

#### 什么是B+树？
（1）B+树是基于B树和叶子节点顺序访问指针进行实现，具有B树的平衡性，且通过顺序访问指针来提高区间查询的速度。  
（2）在B+树中，一个节点中的key从左到右是非递减排列，比如某个指针左右相邻key分别是i和i+1，则该指针指向节点的所有key大于等于i且小于等于i+1。  
（3）进行查找操作时，首先在根节点进行二分查找，找到一个key所在指针，然后递归地在指针所指向的节点进行查找。知道查找到叶子节点，然后在叶子节点上
进行二分查找，找出key所对应的data。  
（4）插入、删除操作会破坏树的平衡性，需要对树进行分裂、合并以及旋转来维护平衡性。  

#### 为什么选用B+树而不是B树？
主要考虑的是IO对性能的影响，B树的每个节点都存储数据，而B+树只有叶子节点才存储数据，所以查找相同数据量的情况下，B树的高度更高，IO更频繁。  
数据库索引是存储在磁盘上的，当数据量大时，就不能把整个索引全部加载到内存了，只能逐一加载每一个磁盘页（对应索引树的节点）。  
详细请见：https://mp.weixin.qq.com/s/BWlkrHiB-uP6fDnsxtKU0Q

### 3.什么是聚蔟索引？
聚蔟索引是对磁盘上实际数据重新组织以按指定的一个或多个列的值排序的算法。特点是存储数据的顺序和索引顺序一致。一般情况下主键会默认创建聚蔟索引，且
一张表只允许存在一个聚蔟索引。  
详细请见：https://www.jianshu.com/p/72763d47aa1a

#### 聚蔟索引与非聚蔟索引的区别
聚蔟索引的叶子节点就是数据节点，而非聚蔟索引的叶子节点仍然是索引节点，只不过有指向对应数据块的指针。  

**非聚蔟索引**  
以MyISAM引擎为例，一个数据表table中，有table.frm，table.myd以及table.myi组。其中table.myd记录了数据，table.myi记录了索引数据。在用到索引时，
先去table.myi查询，取到数据所在table.myd的行位置，拿到数据。所以**myisam引擎的索引文件和数据文件是独立分开的，称之为非聚蔟索引**。  

**聚蔟索引**  
以innodb为例，在一个table中，其数据文件和索引文件是同一个文件。在查询过程中，找到了索引，就找到了数据文件。**在innodb中，即存储主键索引值，又
存储行数据，称之为聚蔟索引**。  
**innodb索引，指向主键对数据的引用**。非主键索引则指向对主键的引用。innodb中，没有主键索引，则会使用unique索引，没有unique索引，则会使用数据库
内部的一个行的id来当做主键索引。  

### 4.什么是最左前缀原则？
Mysql使用联合索引时，需要满足最左前缀原则。举例如下：  
* 一个2列的索引（name, age），对（name）、（name，age）上建立了索引。  
* 一个3列的索引（name，age，sex），对（name）、（name，age）、（name，age，sex）上建立了索引。  

（1）当B+树的数据项是符合的数据结构时，例如（name，age，sex），B+树是按照从左到右的顺序来建立搜索树的，其会优先使用name来确定下一步的所搜方向，
如果name相同再依次比较age和sex。但是如果当（22，男）这样的没有name的数据来的时候，B+树不知道第一步该查哪个节点，这样就使用不到这个索引。  
（2）当（小明，男）这样的数据来检索时，B+树可以用name来指定搜索方向，但下一个字段age的确实，所以只能把名字等于小明的数据都找到，然后再匹配性别
是男的数据了。  
（3）最左前缀匹配原则会一直向右匹配直到遇到范围查询（>,<,between,like）就停止匹配，比如a=1 and b=2 and c>3 and d=4，如果建立（a,b,c,d），则d
是用不到索引的；但如果建立（a,b,d,c），则都可以用到索引。  
（4）=和in可以乱序，比如：a=1 and b=2 and c=3建立（a,b,c）索引可以任意顺序，Mysql的优化器会优化成索引可以识别的形式。  

### 5.怎么知道创建的索引有没有被用到？
使用Explain命令查看语句的执行计划，Mysql在执行某个语句前，会将语句过一遍查询优化器，之后得到该语句的分析，其中包含了许多信息。可以通过其中跟索引
有关的信息分析是否命中了索引。例如：possible_key、key、key_len等字段，分别说明了此语句可能使用的索引、实际使用的索引以及使用的索引长度。  

### 6.什么情况下索引会失效？查询不走索引？
#### （1）索引参与表达式计算
```
select sname from stu where age+10 = 30;
```

#### （2）函数运算
```
select sname from stu where left(date,4) < 1990；
```

#### （3）模糊查询（%%）
```
select * from manong where uname like '码农'%;  ----走索引
select * from manong where uname like %'码农'%; ----不走索引
```

#### （4）字符串与数字比较不走索引
```
create table a(a char(10));
explain select * from a where a = '1';  ----走索引
explain select * from a where a = 1;    ----不走索引，同样是使用了函数运算
```

#### （5）查询条件中有or，即使其中有字段建立了索引也不会使用；换言之，要求使用的所有字段都建立索引
```
select * from dept where a = 1 or b = 2 or c = 3;
```

#### （6）正则表达式不使用索引
#### （7）Mysql优化器会对SQL语句进行优化，若其认为全表扫描比使用索引快，则不使用索引

























